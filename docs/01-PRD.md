# Product Requirements Document: Foundry

Generated by: Product Definition Agent v17 (Sonnet-Optimized)
Date: 2026-01-22
Status: Draft

---

## 1. Executive Summary

### Product Overview

Foundry is a multi-tenant data preparation platform that transforms raw business data from any source into clean, de-identified, structured datasets ready for AI systems, agents, and evaluation workflows. The platform abstracts away the complexity of extraction, privacy handling, schema normalization, and output formatting through a configuration-driven workflow, enabling organizations to unlock the value of their existing data safely and consistently without custom engineering.

### Value Proposition

Foundry enables organizations to transform scattered, sensitive business data into structured, AI-ready datasets in minutes rather than weeks, without writing code or hiring specialized engineers.

### Target Market

B2B SaaS companies and enterprises with operational data in helpdesks, CRMs, document stores, and internal tools who want to leverage their data for AI agents, internal tools, and intelligent workflows but lack the technical resources to prepare it safely.

### Key Differentiators

- Configuration-driven rather than code-driven: non-technical users can prepare datasets without engineering support
- Privacy-first with de-identification as a first-class feature, not an afterthought
- Source-agnostic architecture treating files, APIs, and databases as equal inputs
- Schema-first normalization enabling consistent AI behavior regardless of data origin
- Immediate value from single file upload with growth path to full automation

### Deployment Target

Replit (web application)

---

## 2. Problem Statement

### The Problem

Operations managers, AI engineers, and business analysts at B2B companies spend 2-4 weeks of engineering time per data source to prepare their operational data for AI use. They must manually extract data from helpdesks, CRMs, and internal tools, then write custom scripts to remove customer PII, normalize inconsistent formats, and transform the output into structures their AI systems can consume. This work is repeated for every new data source, every schema change, and every new AI project, creating a bottleneck that prevents organizations from leveraging their most valuable asset: their own operational data.

### Current Alternatives

**Manual Engineering Approach:** Companies hire data engineers or contractors to build custom ETL pipelines for each data source. This costs $10,000-50,000 per integration, takes 4-8 weeks, and requires ongoing maintenance when source systems change.

**Generic ETL Tools (Fivetran, Airbyte):** These tools move data between systems but don't handle AI-specific requirements like de-identification, conversational data parsing, or AI-ready output formats. Users still need custom engineering for the "last mile" of AI readiness.

**Manual Export and Spreadsheet Processing:** Teams export data to CSV, manually scrub PII in spreadsheets, and reformat by hand. This doesn't scale beyond small datasets and introduces significant compliance risk.

### Quantified Impact

- 2-4 weeks of engineering time per data source integration
- $10,000-50,000 cost per custom pipeline
- 70% of AI projects stall at the "data preparation" phase
- Average organization has 5-10 data sources they want to connect but can't justify the investment
- Manual PII handling creates compliance exposure and audit risk

### Who Experiences This Pain

Operations Directors who want to improve AI-powered support automation but can't get engineering resources allocated. AI/ML Engineers who spend 60% of their time on data preparation instead of model development. Compliance Officers who worry about PII exposure in ad-hoc data sharing for AI projects.

---

## 3. User Personas

### Persona 1: Alex - The Operations Director

**Demographics:**
- Job Title: Director of Customer Operations
- Company Size: 50-500 employees
- Industry: B2B SaaS, Technology Services
- Technical Proficiency: Intermediate (comfortable with spreadsheets and basic data concepts, not a programmer)

**Goals:**
- Improve support team efficiency through AI-powered tools
- Reduce response times by training AI agents on historical support data
- Create knowledge bases from existing documentation and conversations
- Demonstrate ROI on AI initiatives to leadership

**Motivations:**
- Wants to be seen as innovative and forward-thinking
- Pressure from leadership to adopt AI solutions
- Genuinely cares about team productivity and customer satisfaction
- Values tools that don't require begging engineering for help

**Pain Points:**
- Engineering team is always "too busy" to help with data projects
- Previous attempts at AI tools failed due to poor data quality
- Worried about exposing customer data inappropriately
- Frustrated by the gap between AI vendor promises and reality

**Usage Context:**
Uses Foundry weekly to prepare datasets for AI agent training. Typically uploads support ticket exports, configures de-identification rules once, then re-runs processing as new data accumulates. Works during business hours from laptop.

**Success Metrics (From Their Perspective):**
- Time from "I have data" to "AI system is trained" reduced from weeks to hours
- Zero compliance incidents from data preparation
- Able to iterate on AI projects without engineering involvement

### Persona 2: Jordan - The AI/ML Engineer

**Demographics:**
- Job Title: Machine Learning Engineer / AI Engineer
- Company Size: 100-1000 employees
- Industry: Technology, Financial Services, Healthcare Tech
- Technical Proficiency: Advanced (Python, SQL, ML frameworks)

**Goals:**
- Spend more time on model development, less on data wrangling
- Create high-quality training datasets quickly
- Establish repeatable data pipelines for model retraining
- Ensure data quality and consistency across projects

**Motivations:**
- Passionate about building intelligent systems
- Frustrated by "boring" data preparation work
- Values automation and reproducibility
- Wants to ship models faster to demonstrate value

**Pain Points:**
- Spends 60%+ of time on data cleaning and preparation
- Every new data source requires writing custom parsers
- PII removal is tedious and error-prone
- Inconsistent data formats cause model performance issues

**Usage Context:**
Uses Foundry to prepare training datasets for fine-tuning and RAG systems. Connects multiple data sources, defines custom schemas, and exports to JSONL for model training. Uses API connections for automated pipelines. Works across time zones, often during deep work blocks.

**Success Metrics (From Their Perspective):**
- Data preparation time reduced by 80%
- Consistent schema across all training data sources
- Automated pipeline that refreshes datasets without manual intervention

### Persona 3: Sam - The Compliance-Conscious Analyst

**Demographics:**
- Job Title: Business Analyst / Data Analyst
- Company Size: 200-2000 employees
- Industry: Financial Services, Healthcare, Insurance
- Technical Proficiency: Intermediate (SQL, BI tools, some Python)

**Goals:**
- Create datasets for AI evaluation and testing
- Ensure all data handling is auditable and compliant
- Build reference datasets for measuring AI performance
- Support the organization's AI initiatives without creating risk

**Motivations:**
- Deeply concerned about data privacy and compliance
- Wants to enable AI adoption while managing risk
- Values documentation and audit trails
- Needs to demonstrate due diligence to leadership

**Pain Points:**
- Manual PII scrubbing is inconsistent and unverifiable
- No audit trail for how data was transformed
- Difficult to prove compliance in reviews
- Caught between pressure to move fast and need to be careful

**Usage Context:**
Uses Foundry to create evaluation datasets for AI systems. Focuses heavily on de-identification verification and processing lineage. Exports datasets for AI testing and benchmarking. Works during business hours, often preparing for quarterly reviews.

**Success Metrics (From Their Perspective):**
- Complete audit trail for all data transformations
- Verifiable de-identification with no PII leakage
- Ability to reproduce exact datasets for compliance reviews

---

## 4. User Stories and Requirements

### Authentication Stories

#### US-AUTH-001: User Registration
Persona: Alex (Operations Director)
Story: As a new user who received an invitation, I want to register with email and password so that I can access my organization's Foundry workspace

Acceptance Criteria:
  - Given I have an invitation link, when I click it, then I see a registration form with email pre-filled
  - Given I'm on the registration form, when I enter a valid password meeting requirements (8+ chars, mixed case, number), then my account is created
  - Given I enter a password that doesn't meet requirements, when I submit, then I see specific validation errors
  - Given registration succeeds, when my account is created, then I'm redirected to the dashboard
  - Given the invitation link has expired or been used, when I access it, then I see an error message explaining the issue

Priority: P0-Critical
MVP Status: MVP
Dependencies: None
Estimated Complexity: M

#### US-AUTH-002: User Login
Persona: Alex (Operations Director)
Story: As a registered user, I want to log in with my email and password so that I can access my projects and data

Acceptance Criteria:
  - Given I'm on the login page, when I enter valid credentials, then I'm authenticated and redirected to dashboard
  - Given I enter invalid credentials, when I submit, then I see an error message without revealing which field was wrong
  - Given I'm logged in, when I close my browser and return within 24 hours, then I remain logged in
  - Given my session has expired, when I try to access a protected page, then I'm redirected to login

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-AUTH-001
Estimated Complexity: S

#### US-AUTH-003: Password Reset
Persona: Alex (Operations Director)
Story: As a user who forgot my password, I want to reset it via email so that I can regain access to my account

Acceptance Criteria:
  - Given I'm on the login page, when I click "Forgot Password", then I see a password reset form
  - Given I enter my registered email, when I submit, then I receive a password reset email within 5 minutes
  - Given I have a reset link, when I click it within 1 hour, then I can set a new password
  - Given I have a reset link older than 1 hour, when I click it, then I see an expiration message
  - Given I enter an unregistered email, when I submit, then I see the same success message (security: don't reveal account existence)

Priority: P1-High
MVP Status: MVP
Dependencies: US-AUTH-001
Estimated Complexity: M

#### US-AUTH-004: User Logout
Persona: Alex (Operations Director)
Story: As a logged-in user, I want to log out so that I can secure my session when I'm done

Acceptance Criteria:
  - Given I'm logged in, when I click logout, then my session is terminated
  - Given I've logged out, when I try to access a protected page, then I'm redirected to login
  - Given I've logged out, when I press back button, then I don't see authenticated content

Priority: P1-High
MVP Status: MVP
Dependencies: US-AUTH-002
Estimated Complexity: S

### Organization & Team Stories

#### US-ORG-001: View Organization
Persona: Alex (Operations Director)
Story: As an organization member, I want to see my organization's details so that I know which workspace I'm in

Acceptance Criteria:
  - Given I'm logged in, when I view organization settings, then I see organization name and my role
  - Given I'm a member, when I view settings, then I see limited information (name, my role)
  - Given I'm an admin, when I view settings, then I see all organization details including member list

Priority: P1-High
MVP Status: MVP
Dependencies: US-AUTH-002
Estimated Complexity: S

#### US-ORG-002: Invite Team Member
Persona: Alex (Operations Director)
Story: As an organization admin, I want to invite team members so that my colleagues can collaborate on data preparation

Acceptance Criteria:
  - Given I'm an admin, when I access team settings, then I see an "Invite Member" option
  - Given I enter a valid email, when I send invitation, then the invitee receives an email with registration link
  - Given I invite someone already in the organization, when I submit, then I see an error that they're already a member
  - Given I enter an invalid email format, when I submit, then I see a validation error
  - Given invitation is sent, when I view pending invitations, then I see the invited email and expiration date

Priority: P1-High
MVP Status: MVP
Dependencies: US-ORG-001
Estimated Complexity: M

#### US-ORG-003: Manage Team Roles
Persona: Alex (Operations Director)
Story: As an organization admin, I want to assign roles to team members so that I can control who can manage settings versus only use the platform

Acceptance Criteria:
  - Given I'm an admin, when I view team members, then I see each member's current role
  - Given I'm an admin, when I change a member's role, then their permissions update immediately
  - Given I try to remove the last admin, when I submit, then I see an error preventing this action
  - Given I'm not an admin, when I try to access role management, then I see an access denied message

Priority: P2-Medium
MVP Status: MVP
Dependencies: US-ORG-002
Estimated Complexity: M

### Project Stories

#### US-PROJ-001: Create Project
Persona: Alex (Operations Director)
Story: As an organization member, I want to create a new project so that I can organize my data preparation work for a specific AI initiative

Acceptance Criteria:
  - Given I'm on the dashboard, when I click "New Project", then I see a project creation form
  - Given I enter a valid project name and description, when I submit, then the project is created and I'm taken to it
  - Given I enter a duplicate project name, when I submit, then I see an error message
  - Given the project is created, when I view it, then it shows zero sources and zero datasets

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-AUTH-002
Estimated Complexity: M

#### US-PROJ-002: View Project List
Persona: Alex (Operations Director)
Story: As an organization member, I want to see all projects in my organization so that I can find and access my work

Acceptance Criteria:
  - Given I'm on the dashboard, when projects exist, then I see a list of all organization projects
  - Given projects exist, when I view the list, then I see project name, description, last updated date, and dataset count
  - Given no projects exist, when I view the dashboard, then I see an empty state with "Create First Project" prompt
  - Given many projects exist, when I view the list, then projects are sorted by last updated (most recent first)

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-PROJ-001
Estimated Complexity: S

#### US-PROJ-003: Edit Project
Persona: Alex (Operations Director)
Story: As a project owner, I want to edit project details so that I can update the name and description as the initiative evolves

Acceptance Criteria:
  - Given I'm viewing a project, when I click "Settings", then I see editable project details
  - Given I update the name, when I save, then the new name appears everywhere
  - Given I update to a duplicate name, when I save, then I see a validation error
  - Given I update the description, when I save, then the new description is visible

Priority: P2-Medium
MVP Status: MVP
Dependencies: US-PROJ-001
Estimated Complexity: S

#### US-PROJ-004: Delete Project
Persona: Alex (Operations Director)
Story: As a project owner, I want to delete a project so that I can remove initiatives that are no longer needed

Acceptance Criteria:
  - Given I'm in project settings, when I click "Delete Project", then I see a confirmation dialog
  - Given I confirm deletion, when I proceed, then the project and all its data are permanently removed
  - Given I cancel deletion, when I dismiss the dialog, then no changes occur
  - Given the project has processed datasets, when I view confirmation, then I see a warning about data loss

Priority: P2-Medium
MVP Status: MVP
Dependencies: US-PROJ-001
Estimated Complexity: S

### Source Connection Stories

#### US-SRC-001: Upload File Source
Persona: Alex (Operations Director)
Story: As a project member, I want to upload CSV, Excel, or JSON files so that I can use my exported data as a source

Acceptance Criteria:
  - Given I'm in a project, when I click "Add Source", then I see file upload as an option
  - Given I select a valid CSV/Excel/JSON file under 100MB, when I upload, then the file is accepted and columns are detected
  - Given I upload a file, when processing completes, then I see detected columns with sample values
  - Given I upload an invalid file type, when I attempt upload, then I see an error listing supported formats
  - Given I upload a file over 100MB, when I attempt upload, then I see a file size error
  - Given I upload a malformed file, when parsing fails, then I see a specific error about the parsing issue

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-PROJ-001
Estimated Complexity: L

#### US-SRC-002: Connect Teamwork Desk API
Persona: Jordan (AI/ML Engineer)
Story: As a project member, I want to connect my Teamwork Desk account so that I can pull support tickets directly without manual export

Acceptance Criteria:
  - Given I'm adding a source, when I select "Teamwork Desk", then I see API credential configuration
  - Given I enter valid API credentials, when I test connection, then I see a success message
  - Given I enter invalid credentials, when I test connection, then I see a specific authentication error
  - Given connection succeeds, when I proceed, then I see available data types (tickets, conversations)
  - Given I select data types, when I save, then the source is configured and ready for data pull

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-PROJ-001
Estimated Complexity: XL

#### US-SRC-003: View Source List
Persona: Alex (Operations Director)
Story: As a project member, I want to see all sources in my project so that I can manage my data inputs

Acceptance Criteria:
  - Given I'm viewing a project, when sources exist, then I see a list of all configured sources
  - Given sources exist, when I view the list, then I see source name, type, status, and last sync date
  - Given no sources exist, when I view the project, then I see an empty state prompting to add a source
  - Given a source has errors, when I view the list, then I see an error indicator

Priority: P1-High
MVP Status: MVP
Dependencies: US-SRC-001
Estimated Complexity: S

#### US-SRC-004: Delete Source
Persona: Alex (Operations Director)
Story: As a project member, I want to remove a source so that I can clean up sources I no longer need

Acceptance Criteria:
  - Given I'm viewing a source, when I click "Delete", then I see a confirmation dialog
  - Given source data was used in processed datasets, when I view confirmation, then I see a warning about impact
  - Given I confirm deletion, when I proceed, then the source and its cached data are removed
  - Given I cancel deletion, when I dismiss dialog, then no changes occur

Priority: P2-Medium
MVP Status: MVP
Dependencies: US-SRC-001
Estimated Complexity: S

### Schema Configuration Stories

#### US-SCHEMA-001: Auto-Detect Schema
Persona: Alex (Operations Director)
Story: As a project member, I want Foundry to automatically detect and suggest schema mappings so that I don't have to configure everything manually

Acceptance Criteria:
  - Given I've added a source, when detection runs, then I see suggested column mappings to canonical fields
  - Given detection finds conversational data, when I view suggestions, then conversation-specific fields are proposed
  - Given detection is uncertain about a mapping, when I view suggestions, then uncertain fields are flagged for review
  - Given I accept suggestions, when I save, then the mappings are applied to the source

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-SRC-001
Estimated Complexity: L

#### US-SCHEMA-002: Manual Schema Mapping
Persona: Jordan (AI/ML Engineer)
Story: As a project member, I want to manually map source fields to output schema so that I can correct auto-detection or handle custom structures

Acceptance Criteria:
  - Given I'm configuring a source, when I view field mappings, then I see all source fields with current mappings
  - Given I select a source field, when I choose a target canonical field, then the mapping is updated
  - Given I want to ignore a field, when I mark it as "skip", then it won't appear in output
  - Given I save mappings, when I return later, then my mappings are preserved
  - Given a required canonical field has no mapping, when I try to process, then I see a validation error

Priority: P1-High
MVP Status: MVP
Dependencies: US-SCHEMA-001
Estimated Complexity: M

#### US-SCHEMA-003: Preview Mapped Data
Persona: Alex (Operations Director)
Story: As a project member, I want to preview how my data will look after mapping so that I can verify configuration before processing

Acceptance Criteria:
  - Given I've configured mappings, when I click "Preview", then I see sample records in the output format
  - Given preview shows data, when I review, then I see both original and mapped values side by side
  - Given mappings have issues, when preview runs, then problems are highlighted in the preview
  - Given I'm satisfied with preview, when I proceed, then I can continue to processing configuration

Priority: P1-High
MVP Status: MVP
Dependencies: US-SCHEMA-002
Estimated Complexity: M

### De-identification Stories

#### US-DEID-001: Configure PII Detection
Persona: Sam (Compliance-Conscious Analyst)
Story: As a project member, I want to configure what types of PII should be detected so that I can ensure compliance with my organization's policies

Acceptance Criteria:
  - Given I'm configuring processing, when I view de-identification settings, then I see a list of PII types (email, phone, name, address, etc.)
  - Given PII types are listed, when I enable/disable types, then detection rules are updated accordingly
  - Given I enable a PII type, when processing runs, then that type is detected and masked
  - Given I want to add custom patterns, when I enter a regex pattern, then it's added to detection rules

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-SRC-001
Estimated Complexity: L

#### US-DEID-002: Preview De-identification
Persona: Sam (Compliance-Conscious Analyst)
Story: As a project member, I want to preview de-identification results so that I can verify PII is being properly detected and masked

Acceptance Criteria:
  - Given I've configured de-identification, when I click "Preview", then I see sample records with PII highlighted
  - Given preview shows PII, when I review, then detected PII is shown with mask preview (e.g., "[EMAIL]", "[PHONE]")
  - Given a field contains PII, when shown in preview, then original and masked versions are displayed
  - Given detection missed PII, when I identify it, then I can adjust rules and re-preview

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-DEID-001
Estimated Complexity: M

#### US-DEID-003: Configure Masking Rules
Persona: Sam (Compliance-Conscious Analyst)
Story: As a project member, I want to configure how detected PII is masked so that I can choose between replacement tokens, redaction, or pseudonymization

Acceptance Criteria:
  - Given I'm configuring de-identification, when I view masking options, then I see replacement, redaction, and pseudonymization
  - Given I select replacement, when processing runs, then PII is replaced with type tokens (e.g., [EMAIL])
  - Given I select redaction, when processing runs, then PII is replaced with [REDACTED]
  - Given I select pseudonymization, when processing runs, then PII is replaced with consistent fake values
  - Given I save masking configuration, when I return later, then my settings are preserved

Priority: P1-High
MVP Status: MVP
Dependencies: US-DEID-001
Estimated Complexity: M

### Processing Stories

#### US-PROC-001: Configure Processing Pipeline
Persona: Jordan (AI/ML Engineer)
Story: As a project member, I want to configure my processing pipeline stages so that I can control what transformations are applied to my data

Acceptance Criteria:
  - Given I'm configuring processing, when I view pipeline, then I see ordered stages (ingest, normalize, de-identify, filter, export)
  - Given I view a stage, when I click configure, then I see stage-specific settings
  - Given I configure filters, when I set criteria, then only matching records pass through
  - Given I save configuration, when I return later, then all settings are preserved

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-SCHEMA-001, US-DEID-001
Estimated Complexity: L

#### US-PROC-002: Run Processing
Persona: Alex (Operations Director)
Story: As a project member, I want to run processing on my configured pipeline so that I can generate an AI-ready dataset

Acceptance Criteria:
  - Given my pipeline is configured, when I click "Process", then processing begins
  - Given processing is running, when I view status, then I see progress indicator and current stage
  - Given processing completes successfully, when I view results, then I see output dataset with record count
  - Given processing encounters errors, when errors occur, then I see specific error messages and affected records
  - Given processing is running, when I want to cancel, then I can stop processing

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-PROC-001
Estimated Complexity: XL

#### US-PROC-003: View Processing History
Persona: Sam (Compliance-Conscious Analyst)
Story: As a project member, I want to see the history of processing runs so that I can track what was processed and when

Acceptance Criteria:
  - Given I'm viewing a project, when I access processing history, then I see a list of all processing runs
  - Given runs exist, when I view the list, then I see run date, duration, input/output record counts, status
  - Given I click a past run, when I view details, then I see full configuration used for that run
  - Given runs have errors, when I view history, then failed runs are clearly marked

Priority: P1-High
MVP Status: MVP
Dependencies: US-PROC-002
Estimated Complexity: M

#### US-PROC-004: Re-run Processing
Persona: Alex (Operations Director)
Story: As a project member, I want to re-run processing with updated source data so that I can keep my datasets current

Acceptance Criteria:
  - Given I have a previous processing run, when I click "Re-run", then processing starts with current source data
  - Given source data has changed, when re-run completes, then output reflects the updated data
  - Given re-run is triggered, when it completes, then previous output is replaced (not duplicated)
  - Given I want to compare runs, when viewing history, then I can see differences in record counts

Priority: P1-High
MVP Status: MVP
Dependencies: US-PROC-002
Estimated Complexity: M

### Export Stories

#### US-EXP-001: Export Dataset
Persona: Jordan (AI/ML Engineer)
Story: As a project member, I want to export my processed dataset so that I can use it in my AI systems

Acceptance Criteria:
  - Given processing has completed, when I click "Export", then I see format options (JSONL, JSON, CSV)
  - Given I select JSONL format, when I export, then I receive a properly formatted JSONL file
  - Given I select conversational JSONL, when I export, then conversations are structured for fine-tuning
  - Given I select Q&A pairs, when I export, then data is formatted as question/answer pairs
  - Given export completes, when I download, then the file downloads to my device

Priority: P0-Critical
MVP Status: MVP
Dependencies: US-PROC-002
Estimated Complexity: M

#### US-EXP-002: View Dataset Preview
Persona: Alex (Operations Director)
Story: As a project member, I want to preview my exported dataset so that I can verify quality before downloading

Acceptance Criteria:
  - Given I have a processed dataset, when I click "Preview", then I see sample records in the export format
  - Given I'm previewing, when I view records, then I see properly de-identified, normalized data
  - Given records exist, when I page through preview, then I can see multiple sample records
  - Given preview is shown, when I'm satisfied, then I can proceed to download

Priority: P1-High
MVP Status: MVP
Dependencies: US-EXP-001
Estimated Complexity: S

### Quality & Filtering Stories

#### US-QUAL-001: Configure Quality Filters
Persona: Jordan (AI/ML Engineer)
Story: As a project member, I want to configure quality filters so that I can exclude low-quality records from my dataset

Acceptance Criteria:
  - Given I'm configuring processing, when I access filters, then I see quality filtering options
  - Given filter options exist, when I set minimum message length, then short records are excluded
  - Given I enable conversation completeness filter, when processing runs, then incomplete conversations are excluded
  - Given I save filter configuration, when processing runs, then filters are applied

Priority: P1-High
MVP Status: MVP
Dependencies: US-PROC-001
Estimated Complexity: M

#### US-QUAL-002: Review Filtered Records
Persona: Sam (Compliance-Conscious Analyst)
Story: As a project member, I want to see which records were filtered out so that I can verify filtering is working correctly

Acceptance Criteria:
  - Given processing has completed, when I view results, then I see filtered record count
  - Given records were filtered, when I click to review, then I see sample filtered records with filter reason
  - Given I review filtered records, when I identify false positives, then I can adjust filter rules
  - Given I adjust filters, when I re-run, then the updated filters are applied

Priority: P2-Medium
MVP Status: MVP
Dependencies: US-QUAL-001
Estimated Complexity: M

### Role Identification Stories

#### US-ROLE-001: Identify Conversation Roles
Persona: Jordan (AI/ML Engineer)
Story: As a project member working with conversational data, I want Foundry to identify speaker roles so that AI systems can distinguish between agents and customers

Acceptance Criteria:
  - Given my source contains conversations, when I configure processing, then I see role identification options
  - Given role identification is enabled, when processing runs, then each message is tagged with role (agent/customer/system)
  - Given roles are identified, when I preview output, then I see role labels on each message
  - Given auto-detection fails, when I review, then I can manually specify role identification rules

Priority: P1-High
MVP Status: MVP
Dependencies: US-SCHEMA-001
Estimated Complexity: L

### User Profile Stories

#### US-PROF-001: Update Profile
Persona: Alex (Operations Director)
Story: As a user, I want to update my profile information so that my details are current

Acceptance Criteria:
  - Given I'm logged in, when I access settings, then I see my profile information
  - Given I update my name, when I save, then my name is updated throughout the application
  - Given I update my email, when I save, then I must verify the new email before it takes effect
  - Given I want to change password, when I enter current and new password, then my password is updated

Priority: P2-Medium
MVP Status: MVP
Dependencies: US-AUTH-002
Estimated Complexity: M

### Story Summary

| Priority | Count | % of Total |
|----------|-------|------------|
| P0-Critical | 10 | 31% |
| P1-High | 13 | 41% |
| P2-Medium | 9 | 28% |
| P3-Low | 0 | 0% |
| **Total** | **32** | **100%** |

| MVP Status | Count | % of Total |
|------------|-------|------------|
| MVP | 32 | 100% |
| Post-MVP | 0 | 0% |
| Future | 0 | 0% |
| **Total** | **32** | **100%** |

---

## 5. Feature Specification

### FEAT-001: User Authentication
ID: FEAT-001
Name: User Authentication
User Stories: US-AUTH-001, US-AUTH-002, US-AUTH-003, US-AUTH-004

Description:
Complete authentication system supporting invite-based registration, email/password login, password reset, and secure session management. The system enforces organization-level isolation ensuring users can only access their organization's data.

Functional Requirements:
- Invite-only registration with email verification
- Email/password login with secure session handling
- Password reset via time-limited email tokens
- Session persistence with 24-hour JWT expiry
- Automatic session cleanup and redirect on expiry

Non-Functional Requirements:
- Performance: Login response under 500ms
- Security: Password hashing with bcrypt, rate limiting on auth endpoints
- Accessibility: WCAG 2.1 AA compliant forms

Edge Cases:
- User tries to register without invitation: Show appropriate error, don't reveal invite-only policy details
- User tries to login before completing registration: Show "account not found" error
- Multiple password reset requests: Only the most recent token is valid

Error States:
- Invalid credentials: "Invalid email or password" (don't reveal which)
- Expired invitation: "This invitation has expired. Please request a new one."
- Expired reset token: "This password reset link has expired. Please request a new one."

Out of Scope (Post-MVP):
- SSO/SAML authentication
- Multi-factor authentication
- Social login providers

### FEAT-002: Organization Management
ID: FEAT-002
Name: Organization Management
User Stories: US-ORG-001, US-ORG-002, US-ORG-003

Description:
Multi-tenant organization system with role-based access control. Each organization is fully isolated with its own users, projects, and data. Supports admin and member roles with appropriate permission boundaries.

Functional Requirements:
- Organization creation during first-user setup
- Role-based access: Admin (full access) and Member (project access)
- Team member invitation via email
- Member role management by admins
- Organization settings viewing by all members

Non-Functional Requirements:
- Performance: Member list loads under 1 second for organizations up to 100 members
- Security: Complete data isolation between organizations at database level
- Accessibility: WCAG 2.1 AA compliant interfaces

Edge Cases:
- Last admin tries to leave or downgrade: Prevent, require admin transfer first
- Invited user already in different organization: Show error, user must choose one
- Admin invites existing organization member: Show "already a member" error

Error States:
- Permission denied: "You don't have permission to perform this action"
- Invalid invitation: "This invitation is no longer valid"
- Organization limit reached: Future consideration for paid tiers

Out of Scope (Post-MVP):
- Multiple organization membership
- Organization deletion
- Custom role definitions

### FEAT-003: Project Management
ID: FEAT-003
Name: Project Management
User Stories: US-PROJ-001, US-PROJ-002, US-PROJ-003, US-PROJ-004

Description:
Project workspace for organizing data preparation initiatives. Each project contains its own sources, processing configurations, and output datasets. Projects provide isolation for different AI initiatives within an organization.

Functional Requirements:
- Project creation with name and description
- Project listing with search and sort
- Project detail editing
- Project deletion with confirmation
- Project-level statistics (sources, datasets, last activity)

Non-Functional Requirements:
- Performance: Project list loads under 1 second for up to 50 projects
- Security: Organization-scoped access only
- Accessibility: WCAG 2.1 AA compliant interfaces

Edge Cases:
- Duplicate project name in organization: Reject with clear error
- Delete project with active processing: Warn and require cancellation first
- Access project after organization change: Return 404

Error States:
- Project not found: "This project doesn't exist or you don't have access"
- Duplicate name: "A project with this name already exists"
- Delete failed: "Cannot delete project while processing is active"

Out of Scope (Post-MVP):
- Project templates
- Project archiving (soft delete)
- Project sharing across organizations

### FEAT-004: File Source Upload
ID: FEAT-004
Name: File Source Upload
User Stories: US-SRC-001, US-SRC-003, US-SRC-004

Description:
File-based data ingestion supporting CSV, Excel (.xlsx/.xls), and JSON formats. Includes automatic column detection, data type inference, and sample preview. Files are cached for 30 days to support re-processing.

Functional Requirements:
- File upload via drag-drop or file picker
- Support for CSV, Excel (.xlsx/.xls), JSON formats
- Maximum file size: 100MB
- Automatic column/field detection
- Data type inference (string, number, date, boolean)
- Sample data preview (first 100 rows)
- Source caching for 30 days
- Source deletion with cascade to cached data

Non-Functional Requirements:
- Performance: Column detection completes in under 10 seconds for 100MB file
- Security: File type validation, malware scanning consideration
- Accessibility: WCAG 2.1 AA compliant upload interface with keyboard support

Edge Cases:
- File with no headers: Prompt user to specify if first row is headers
- Mixed data types in column: Infer as string, flag for review
- File with encoding issues: Attempt UTF-8, fallback to Latin-1, show warning
- Empty file: Reject with clear error

Error States:
- Invalid file type: "Unsupported file type. Please upload CSV, Excel, or JSON."
- File too large: "File exceeds 100MB limit. Please split into smaller files."
- Parse error: "Unable to parse file. Please check format and try again."

Out of Scope (Post-MVP):
- ZIP file extraction
- PDF parsing
- Image/document OCR
- Files larger than 100MB

### FEAT-005: Teamwork Desk Integration
ID: FEAT-005
Name: Teamwork Desk Integration
User Stories: US-SRC-002

Description:
Direct API integration with Teamwork Desk for pulling support tickets and conversations. Supports OAuth or API key authentication with automatic data synchronization and incremental updates.

Functional Requirements:
- API credential configuration (API key)
- Connection testing and validation
- Data type selection (tickets, conversations)
- Incremental data pull (only new/updated records)
- Manual sync trigger
- Connection status monitoring
- Credential update/rotation

Non-Functional Requirements:
- Performance: Initial sync of 10,000 tickets completes in under 5 minutes
- Security: Encrypted credential storage, no credential logging
- Reliability: Automatic retry on transient API failures

Edge Cases:
- API rate limiting: Implement backoff and queue, show progress indicator
- Credential expiration: Detect and prompt for re-authentication
- Partial sync failure: Complete available records, report failures

Error States:
- Invalid credentials: "Unable to authenticate. Please check your API key."
- API unavailable: "Teamwork Desk is currently unavailable. Please try again later."
- Rate limited: "Request limit reached. Sync will resume automatically."

Out of Scope (Post-MVP):
- OAuth authentication flow
- Real-time webhooks
- Custom field mapping from Teamwork

### FEAT-006: Schema Configuration
ID: FEAT-006
Name: Schema Configuration
User Stories: US-SCHEMA-001, US-SCHEMA-002, US-SCHEMA-003

Description:
Intelligent schema mapping system that normalizes heterogeneous source data into consistent canonical structures. Includes automatic detection with manual override capability and visual mapping preview.

Functional Requirements:
- Automatic field detection from source data
- Canonical schema library (conversation, document, record)
- Field-to-schema mapping interface
- Mapping validation rules
- Preview of mapped data structure
- Mapping persistence per source

Non-Functional Requirements:
- Performance: Auto-detection completes in under 5 seconds
- Security: No data leaves system during mapping
- Accessibility: WCAG 2.1 AA compliant mapping interface

Edge Cases:
- Ambiguous field detection: Flag for manual review with suggestions
- Required canonical field unmapped: Block processing with clear error
- Source schema changes on re-upload: Detect and prompt for mapping review

Error States:
- Mapping validation failed: "Required field [X] is not mapped"
- Incompatible mapping: "Field [X] cannot be mapped to [Y] due to type mismatch"
- No mappable fields: "Unable to detect mappable fields. Please check source format."

Out of Scope (Post-MVP):
- Custom canonical schema creation
- Schema versioning
- Cross-project schema inheritance

### FEAT-007: PII De-identification
ID: FEAT-007
Name: PII De-identification
User Stories: US-DEID-001, US-DEID-002, US-DEID-003

Description:
Comprehensive PII detection and masking system supporting multiple PII types and masking strategies. Provides preview capability for verification before processing and audit logging for compliance.

Functional Requirements:
- PII type detection: email, phone, name, address, SSN, credit card, date of birth
- Custom pattern detection via regex
- Masking strategies: replacement tokens, redaction, pseudonymization
- Detection preview with highlighting
- Per-field de-identification rules
- De-identification audit log

Non-Functional Requirements:
- Performance: Preview of 1000 records completes in under 10 seconds
- Security: PII detection runs in isolated environment, no external API calls
- Accessibility: WCAG 2.1 AA compliant configuration interface

Edge Cases:
- Embedded PII in free text: Detect and mask within larger text blocks
- Multiple PII types in single field: Apply all relevant masks
- False positive detection: Allow field-level override to exclude from detection
- Non-standard format PII: Custom regex support for unusual formats

Error States:
- Pattern validation failed: "Invalid regex pattern: [error details]"
- Preview generation failed: "Unable to generate preview. Please try again."
- Incompatible masking strategy: "Pseudonymization not available for [type]"

Out of Scope (Post-MVP):
- Machine learning-based entity recognition
- International PII format libraries
- Data residency compliance rules

### FEAT-008: Processing Pipeline
ID: FEAT-008
Name: Processing Pipeline
User Stories: US-PROC-001, US-PROC-002, US-PROC-003, US-PROC-004, US-QUAL-001, US-QUAL-002, US-ROLE-001

Description:
Configurable data processing pipeline that executes ordered transformation stages including ingestion, normalization, de-identification, quality filtering, and output formatting. Supports manual trigger, progress monitoring, and re-run capability.

Functional Requirements:
- Pipeline stage configuration (ingest, normalize, de-identify, filter, format)
- Quality filters (min length, completeness, deduplication)
- Role identification for conversational data
- Processing trigger (manual)
- Progress monitoring with stage indicators
- Processing cancellation
- Run history with full configuration snapshots
- Re-run with updated source data

Non-Functional Requirements:
- Performance: Process 100,000 records in under 30 minutes
- Reliability: Checkpoint-based processing with failure recovery
- Security: Processing runs in organization-isolated environment

Edge Cases:
- Processing interrupted by user logout: Continue in background, show on return
- Source data deleted during processing: Fail gracefully with clear error
- Output exceeds 100,000 records: Process in batches with progress indication

Error States:
- Processing failed: "Processing failed at stage [X]: [error details]"
- Source unavailable: "Unable to access source data. Please verify source configuration."
- Resource limit: "Processing halted: record limit reached"

Out of Scope (Post-MVP):
- Scheduled/automated processing
- Real-time streaming processing
- Custom processing stage plugins

### FEAT-009: Dataset Export
ID: FEAT-009
Name: Dataset Export
User Stories: US-EXP-001, US-EXP-002

Description:
Export system generating AI-ready output formats from processed datasets. Supports multiple formats optimized for different AI use cases including fine-tuning, RAG, and evaluation.

Functional Requirements:
- Export formats: Conversational JSONL, Q&A pairs JSON, structured JSON, CSV
- Format preview before download
- Direct download to browser
- Export history with download links

Non-Functional Requirements:
- Performance: Export generation completes in under 2 minutes for 100,000 records
- Security: Exported files contain only de-identified data
- Accessibility: WCAG 2.1 AA compliant export interface

Edge Cases:
- Very large export (approaching browser limits): Stream download
- Export format incompatible with data type: Show warning with alternatives
- Multiple concurrent exports: Queue and process sequentially

Error States:
- Export generation failed: "Unable to generate export. Please try again."
- Download expired: "This export has expired. Please generate a new export."
- Format error: "Data cannot be exported in [format] due to [reason]"

Out of Scope (Post-MVP):
- Direct push to external storage (S3, GCS)
- Direct integration with AI platforms
- API-based export access
- Export scheduling

### FEAT-010: User Profile
ID: FEAT-010
Name: User Profile
User Stories: US-PROF-001

Description:
User profile management for personal settings and preferences including display name, email, and password management.

Functional Requirements:
- View profile information
- Update display name
- Update email with verification
- Change password with current password confirmation

Non-Functional Requirements:
- Performance: Profile operations complete in under 1 second
- Security: Password change requires current password
- Accessibility: WCAG 2.1 AA compliant forms

Edge Cases:
- Email change to already-used email: Reject with error
- Password change with expired session: Require re-authentication
- Profile update during concurrent session: Last write wins

Error States:
- Email already in use: "This email is already associated with another account"
- Invalid current password: "Current password is incorrect"
- Verification email failed: "Unable to send verification email. Please try again."

Out of Scope (Post-MVP):
- Profile photo
- Notification preferences
- Timezone/locale settings

---

## 6. MVP Definition

### MVP Scope Statement

A web application that enables non-technical users to upload data files or connect Teamwork Desk, configure de-identification rules, process data through a configurable pipeline, and export clean, AI-ready datasets in under five minutes.

### MVP Feature List with Removal Tests

| Feature ID | Feature Name | Removal Test Result | Justification if Kept |
|------------|--------------|---------------------|----------------------|
| FEAT-001 | User Authentication | CANNOT remove | Multi-tenant product requires user accounts and organization isolation |
| FEAT-002 | Organization Management | CANNOT remove | Core isolation model; users must belong to organizations for data security |
| FEAT-003 | Project Management | CANNOT remove | Projects are the organizing unit for data preparation work |
| FEAT-004 | File Source Upload | CANNOT remove | Primary MVP input method per executive brief |
| FEAT-005 | Teamwork Desk Integration | CANNOT remove | Mandatory for MVP per executive brief |
| FEAT-006 | Schema Configuration | CANNOT remove | Schema normalization is core value proposition |
| FEAT-007 | PII De-identification | CANNOT remove | Privacy handling is core value proposition |
| FEAT-008 | Processing Pipeline | CANNOT remove | Data transformation is core value proposition |
| FEAT-009 | Dataset Export | CANNOT remove | Output delivery is required for product to provide value |
| FEAT-010 | User Profile | CANNOT remove | Required for password changes and basic account management |

**MVP Decisions:**
- Features kept: All 10 features are essential to core value delivery
- Features removed: None (all features passed removal test)

### MVP Success Criteria

**Launch Success Criteria:**
- 5 beta organizations successfully complete end-to-end workflow (upload -> process -> export)
- Zero PII leaks in exported datasets during beta testing
- 80% of users complete first dataset export without support assistance
- Average time from file upload to first export under 5 minutes

**Post-Launch Metrics (First 30 Days):**
- User Activation Rate: 70% (users who complete at least one export)
- Weekly Active Organizations: 10
- Average Datasets per Organization: 3
- Support Ticket Rate: Less than 0.5 tickets per user

---

## 7. Information Architecture

### Content Organization

Foundry is organized into a hierarchical structure: Organizations contain Projects, Projects contain Sources and Datasets, and each Dataset is produced by a Processing Run. This mirrors the mental model of users organizing their AI initiatives.

Top-level sections:
- Dashboard (project list and quick actions)
- Project workspace (sources, processing, datasets)
- Organization settings (team, billing)
- User settings (profile, security)

### Navigation Structure

**Primary Navigation (Sidebar):**
- Dashboard (project list)
- Current Project (when in project context)
  - Sources
  - Processing
  - Datasets
- Settings

**User Menu (Top-right dropdown):**
- Profile
- Organization Settings
- Logout

### User Flows (Textual Descriptions)

#### Flow 1: First-Time User Onboarding
1. User clicks invitation link from email
2. System shows registration form with email pre-filled
3. User enters password and submits
4. System creates account and shows welcome dashboard
5. User sees empty project list with "Create First Project" prompt
6. User clicks to create project
7. System shows project creation form
8. User enters project name/description and creates
9. Flow completes with user in new empty project

**Error Branches:**
- If invitation expired, system shows "Invitation expired" message
- User can request new invitation from admin

#### Flow 2: Upload File and Process (Target "Aha Moment")
1. User starts in project dashboard
2. User clicks "Add Source" and selects "Upload File"
3. System shows file upload interface
4. User drags CSV file onto upload area
5. System uploads file and detects columns
6. System auto-suggests schema mappings
7. User reviews and accepts mappings
8. User proceeds to de-identification settings
9. System shows PII types with detected instances highlighted
10. User configures masking preferences
11. User clicks "Process"
12. System shows processing progress
13. Processing completes, system shows results summary
14. User clicks "Export" and selects JSONL format
15. User downloads AI-ready dataset
16. Flow completes with exported file

**Error Branches:**
- If file type unsupported, system shows error with supported types
- If file parsing fails, system shows specific error and suggestions
- If processing fails, system shows error with retry option

#### Flow 3: Connect Teamwork Desk
1. User starts in project dashboard
2. User clicks "Add Source" and selects "Teamwork Desk"
3. System shows API configuration form
4. User enters API key
5. User clicks "Test Connection"
6. System validates credentials and shows success
7. User selects data types to sync (tickets, conversations)
8. User clicks "Connect"
9. System begins initial data sync
10. Flow completes with source ready for processing

**Error Branches:**
- If credentials invalid, system shows authentication error
- If API unavailable, system shows retry option
- If rate limited, system queues sync and shows estimated time

#### Flow 4: Invite Team Member
1. Admin navigates to Organization Settings
2. Admin clicks "Team" tab
3. Admin clicks "Invite Member"
4. System shows invitation form
5. Admin enters email and selects role
6. Admin clicks "Send Invitation"
7. System sends email and shows pending invitation
8. Flow completes with invitation sent

**Error Branches:**
- If email already in organization, system shows error
- If email format invalid, system shows validation error

### Page/Screen Inventory (MANDATORY)

| Page Name | Route | Purpose | User Stories | MVP Status |
|-----------|-------|---------|--------------|------------|
| Login | /login | User authentication | US-AUTH-002 | MVP |
| Register | /register/:token | Invitation-based signup | US-AUTH-001 | MVP |
| Forgot Password | /forgot-password | Password reset request | US-AUTH-003 | MVP |
| Reset Password | /reset-password/:token | Complete password reset | US-AUTH-003 | MVP |
| Dashboard | /dashboard | Project list and overview | US-PROJ-002 | MVP |
| Project Create | /projects/new | Create new project | US-PROJ-001 | MVP |
| Project Overview | /projects/:id | Project detail and stats | US-PROJ-002 | MVP |
| Project Settings | /projects/:id/settings | Edit/delete project | US-PROJ-003, US-PROJ-004 | MVP |
| Sources List | /projects/:id/sources | View project sources | US-SRC-003 | MVP |
| Source Upload | /projects/:id/sources/upload | File upload interface | US-SRC-001 | MVP |
| Source Connect | /projects/:id/sources/connect/teamwork | Teamwork Desk setup | US-SRC-002 | MVP |
| Source Detail | /projects/:id/sources/:sourceId | Source configuration | US-SRC-003, US-SRC-004 | MVP |
| Schema Mapping | /projects/:id/sources/:sourceId/schema | Configure field mappings | US-SCHEMA-001, US-SCHEMA-002, US-SCHEMA-003 | MVP |
| De-identification | /projects/:id/sources/:sourceId/deid | Configure PII handling | US-DEID-001, US-DEID-002, US-DEID-003 | MVP |
| Processing Config | /projects/:id/processing | Pipeline configuration | US-PROC-001, US-QUAL-001, US-ROLE-001 | MVP |
| Processing Run | /projects/:id/processing/run | Execute and monitor | US-PROC-002 | MVP |
| Processing History | /projects/:id/processing/history | View past runs | US-PROC-003, US-PROC-004 | MVP |
| Datasets List | /projects/:id/datasets | View processed datasets | US-EXP-001 | MVP |
| Dataset Detail | /projects/:id/datasets/:datasetId | Preview and export | US-EXP-001, US-EXP-002 | MVP |
| Filtered Records | /projects/:id/datasets/:datasetId/filtered | Review filtered out records | US-QUAL-002 | MVP |
| Organization Settings | /settings/organization | Organization details | US-ORG-001 | MVP |
| Team Management | /settings/team | Invite and manage members | US-ORG-002, US-ORG-003 | MVP |
| Accept Invitation | /invite/:token | Existing user joins org | US-ORG-002 | MVP |
| User Profile | /settings/profile | Profile management | US-PROF-001 | MVP |

---

## 8. Assumptions and Constraints

### Technical Assumptions (Replit Context)

| Assumption | Rationale |
|------------|-----------|
| Deployment platform: Replit | Target platform for this agent chain |
| Database: PostgreSQL (Neon) | Replit-managed PostgreSQL |
| Architecture: Monolithic full-stack | Single container deployment model |
| Frontend: React with TypeScript | Modern web framework |
| Backend: Express.js with TypeScript | Node.js backend framework |
| ORM: Drizzle | Type-safe database ORM |
| Authentication: JWT-based | Per Constitution Section C, 24h expiry |

### Business Assumptions

| Assumption | Impact if Wrong | Mitigation |
|------------|-----------------|------------|
| Organizations will have 1-20 users | UI/UX designed for this scale; larger orgs may need pagination redesign | Monitor org sizes, add pagination if >50 users needed |
| Most data will come from file uploads initially | Teamwork Desk integration may be underutilized | Track source type usage, prioritize based on actual use |
| 100,000 records per project is sufficient for MVP | Larger datasets may require architectural changes | Monitor record counts, prepare batch processing strategy |
| Invite-only onboarding controls quality | May limit growth; users can't self-serve | Plan self-service signup for post-MVP |
| 30-day cache retention is adequate | Users may need longer retention for re-processing | Monitor re-processing patterns, adjust if needed |

### Known Constraints

| Constraint | Implication |
|------------|-------------|
| Single container deployment | Cannot use microservices or separate worker processes |
| Replit resource limits | Must optimize for reasonable compute/memory usage |
| Web browser access only | No native mobile app in MVP |
| 100MB file size limit | Large exports must be split |
| Download-only exports | No direct cloud storage integration |
| Manual processing only | No scheduled or automated pipelines |

### Risks and Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| PII detection misses sensitive data | Medium | High | Extensive testing, preview feature, audit logging |
| Teamwork Desk API changes | Low | Medium | Version API integration, monitor for deprecations |
| Processing times exceed expectations | Medium | Medium | Implement progress indicators, optimize hot paths |
| File parsing fails on edge cases | High | Low | Comprehensive error messages, format documentation |
| User confusion on schema mapping | Medium | Medium | Auto-detection, helpful defaults, preview feature |

---

## 9. Success Metrics

### Key Performance Indicators (KPIs)

| KPI | Measurement Method | Launch Target | 6-Month Target |
|-----|-------------------|---------------|----------------|
| User Activation Rate | % users completing first export | 70% | 85% |
| Time to First Export | Duration from signup to first download | < 5 minutes | < 3 minutes |
| Weekly Active Organizations | Orgs with processing activity per week | 10 | 50 |
| Datasets per Organization | Average processed datasets per org | 3 | 10 |
| Processing Success Rate | % of processing runs completing successfully | 95% | 99% |
| Support Ticket Rate | Tickets per active user per month | 0.5 | 0.2 |

### Analytics Requirements

**Required Tracking:**
- User Registration: Track invitation source, organization size
- Project Creation: Track time from registration, project naming patterns
- Source Addition: Track source type, file sizes, connection success/failure
- Processing Runs: Track duration, record counts, failure reasons, stages
- Exports: Track format preferences, file sizes, download completion
- Feature Usage: Track which features are used, where users spend time
- Error Rates: Track API errors, frontend errors, processing failures

---

## 10. Glossary

| Term | Definition |
|------|------------|
| Organization | A tenant in Foundry; represents a company or team with isolated data |
| Project | A workspace within an organization for a specific AI initiative |
| Source | An origin of raw data connected to a project (file upload or API) |
| Dataset | A processed, AI-ready output generated from source data |
| Canonical Schema | A predefined data structure that source data is normalized into |
| De-identification | The process of removing or masking personally identifiable information |
| Processing Pipeline | The ordered sequence of transformation stages applied to data |
| PII | Personally Identifiable Information - data that can identify an individual |
| Masking | Replacing sensitive data with tokens or redacted values |
| Pseudonymization | Replacing sensitive data with consistent fake values |
| JSONL | JSON Lines format - one JSON object per line, common for AI training |
| Q&A Pairs | Question and Answer format for training conversational AI |
| RAG | Retrieval-Augmented Generation - AI pattern using external knowledge |
| Fine-tuning | Training an AI model on custom data to specialize its behavior |

---

## VALIDATION FOOTER (MANDATORY)

### Completeness Check

- [x] All 10 sections populated with substantial content
- [x] All personas have 3+ user stories
- [x] All user stories have 2+ acceptance criteria
- [x] All MVP features have documented removal test
- [x] All features trace to user stories
- [x] All user stories trace to personas
- [x] All user flows include error states
- [x] Page inventory complete with all pages listed
- [x] Technical assumptions compatible with Replit

### Traceability Matrix

| User Story ID | Feature ID | Page(s) | Status |
|---------------|------------|---------|--------|
| US-AUTH-001 | FEAT-001 | /register/:token |  |
| US-AUTH-002 | FEAT-001 | /login |  |
| US-AUTH-003 | FEAT-001 | /forgot-password, /reset-password/:token |  |
| US-AUTH-004 | FEAT-001 | All (header component) |  |
| US-ORG-001 | FEAT-002 | /settings/organization |  |
| US-ORG-002 | FEAT-002 | /settings/team, /invite/:token |  |
| US-ORG-003 | FEAT-002 | /settings/team |  |
| US-PROJ-001 | FEAT-003 | /projects/new |  |
| US-PROJ-002 | FEAT-003 | /dashboard, /projects/:id |  |
| US-PROJ-003 | FEAT-003 | /projects/:id/settings |  |
| US-PROJ-004 | FEAT-003 | /projects/:id/settings |  |
| US-SRC-001 | FEAT-004 | /projects/:id/sources/upload |  |
| US-SRC-002 | FEAT-005 | /projects/:id/sources/connect/teamwork |  |
| US-SRC-003 | FEAT-004, FEAT-005 | /projects/:id/sources, /projects/:id/sources/:sourceId |  |
| US-SRC-004 | FEAT-004, FEAT-005 | /projects/:id/sources/:sourceId |  |
| US-SCHEMA-001 | FEAT-006 | /projects/:id/sources/:sourceId/schema |  |
| US-SCHEMA-002 | FEAT-006 | /projects/:id/sources/:sourceId/schema |  |
| US-SCHEMA-003 | FEAT-006 | /projects/:id/sources/:sourceId/schema |  |
| US-DEID-001 | FEAT-007 | /projects/:id/sources/:sourceId/deid |  |
| US-DEID-002 | FEAT-007 | /projects/:id/sources/:sourceId/deid |  |
| US-DEID-003 | FEAT-007 | /projects/:id/sources/:sourceId/deid |  |
| US-PROC-001 | FEAT-008 | /projects/:id/processing |  |
| US-PROC-002 | FEAT-008 | /projects/:id/processing/run |  |
| US-PROC-003 | FEAT-008 | /projects/:id/processing/history |  |
| US-PROC-004 | FEAT-008 | /projects/:id/processing/history |  |
| US-QUAL-001 | FEAT-008 | /projects/:id/processing |  |
| US-QUAL-002 | FEAT-008 | /projects/:id/datasets/:datasetId/filtered |  |
| US-ROLE-001 | FEAT-008 | /projects/:id/processing |  |
| US-EXP-001 | FEAT-009 | /projects/:id/datasets, /projects/:id/datasets/:datasetId |  |
| US-EXP-002 | FEAT-009 | /projects/:id/datasets/:datasetId |  |
| US-PROF-001 | FEAT-010 | /settings/profile |  |

### Prompt Maintenance Contract

If this prompt is edited, you MUST:
1. Update the version history with changes and `Hygiene Gate: PASS`
2. Re-run all Prompt Hygiene Gate checks (per Constitution Section L)
3. Confirm encoding is clean (no mojibake or non-ASCII artifacts)
4. Verify no global rules are restated (reference Constitution instead)

If any check fails, the prompt update is invalid and must not be delivered.

### Prompt Hygiene Gate (per Constitution Section L)

- [x] Framework Version header present and correct
- [x] Encoding scan passed: No non-ASCII artifact tokens
- [x] Inheritance statement references Constitution v3.3
- [x] No full restatement of global rules (uses "Per Constitution Section X" references)

### Confidence Scores

| Section | Score (1-10) | Notes |
|---------|--------------|-------|
| Problem Statement | 9 | Well-defined in executive brief |
| Personas | 8 | Inferred from use cases; could benefit from user interviews |
| User Stories | 9 | Comprehensive coverage of stated functionality |
| MVP Scope | 9 | Clear scope from executive brief |
| Replit Compatibility | 9 | Standard patterns, no infrastructure concerns |
| Overall | 9 | Strong foundation from detailed executive brief |

### Flagged Items Requiring Review

1. **Teamwork Desk API specifics**: The exact API endpoints, authentication method (API key vs OAuth), and data structures should be verified against current Teamwork Desk documentation before Agent 4 generates API contracts.

2. **PII detection accuracy targets**: No specific accuracy requirements were stated. Recommend establishing acceptable false positive/negative rates for de-identification before launch.

3. **Organization billing model**: Executive brief mentions "usage-based billing" in expansion path but no pricing or limits for MVP. Confirm if any usage limits apply to MVP tier.

### Document Status: COMPLETE

---

## DOWNSTREAM AGENT HANDOFF BRIEF

### Deployment Context (All Agents)

Per Constitution Section C and Section D: All global platform conventions and Replit non-negotiables apply.

This context applies to all downstream agents. Do not specify infrastructure that conflicts with the Constitution.

### For Agent 2: System Architecture

**Core Technical Challenges:**
- Multi-tenant data isolation with organization-scoped access
- File upload handling with 100MB limit and 30-day caching
- External API integration with Teamwork Desk (rate limiting, credential storage)
- Processing pipeline execution with progress tracking for up to 100,000 records
- PII detection with multiple patterns and masking strategies

**Scale Expectations:**
- Concurrent users: 10-50 (MVP beta)
- Data volume: Up to 100,000 records per project, 100MB files
- API throughput: 100-200 req/min typical usage

**Integration Requirements:**
- Teamwork Desk API: REST API for ticket and conversation data
- No other external integrations for MVP

**Authentication/Authorization Complexity:**
- JWT-based authentication (per Constitution Section C)
- Two roles: Admin and Member
- Organization-scoped data access
- Invite-only registration requiring token validation

**Security Considerations:**
- Credential encryption for API keys (Teamwork Desk)
- PII handling requires audit logging
- Multi-tenant data isolation at database level
- Rate limiting on auth endpoints

**Key Decisions Deferred to You:**
- File storage strategy (local vs cloud)
- Processing architecture (sync vs async, queuing)
- Caching strategy for source data

### For Agent 3: Data Modeling

**Primary Entities Implied:**
- User (from US-AUTH-001 through US-AUTH-004)
- Organization (from US-ORG-001 through US-ORG-003)
- Invitation (from US-AUTH-001, US-ORG-002)
- Project (from US-PROJ-001 through US-PROJ-004)
- Source (from US-SRC-001 through US-SRC-004)
- SchemaMapping (from US-SCHEMA-001 through US-SCHEMA-003)
- DeidentificationConfig (from US-DEID-001 through US-DEID-003)
- ProcessingConfig (from US-PROC-001)
- ProcessingRun (from US-PROC-002 through US-PROC-004)
- Dataset (from US-EXP-001, US-EXP-002)

**Key Relationships:**
- User -> Organization: Many-to-one (users belong to one organization)
- Organization -> Project: One-to-many
- Project -> Source: One-to-many
- Source -> SchemaMapping: One-to-one
- Source -> DeidentificationConfig: One-to-one
- Project -> ProcessingConfig: One-to-one
- Project -> ProcessingRun: One-to-many
- ProcessingRun -> Dataset: One-to-one
- Organization -> Invitation: One-to-many

**Data Lifecycle Considerations:**
- Retention: Source data cached 30 days; processed datasets until deleted
- Deletion: Hard delete for projects (cascade to sources, runs, datasets)
- Archival: Not required for MVP

**Multi-Tenancy Requirements:**
- All queries must be scoped to organization_id
- No cross-organization data access
- Invitation tokens scoped to organization

### For Agent 4: API Contract

**Primary Operations Needed:**
- Users: Create (via invitation), Read (self), Update (self)
- Organizations: Read, Update (admin only)
- Invitations: Create (admin), Read, Delete, Accept
- Projects: Full CRUD
- Sources: Create, Read, Update, Delete
- SchemaMapping: Read, Update
- DeidentificationConfig: Read, Update
- ProcessingConfig: Read, Update
- ProcessingRuns: Create, Read, List
- Datasets: Read, List, Export

**Authentication Requirements:**
- Method: JWT Bearer tokens (per Constitution Section C)
- Token expiry: 24h (per Constitution Section C)
- Refresh: Not required for MVP

**External Integrations:**
- Teamwork Desk API: REST, API key authentication

**Real-Time Requirements:**
- Processing progress updates (consider polling or SSE)

### For Agent 5: UI/UX Specification

**Primary User Flows:**
- First-time user onboarding (invite -> register -> first project)
- File upload and processing (target "aha moment" flow)
- Teamwork Desk connection
- Team member invitation

**Key Interaction Patterns:**
- File drag-drop upload
- Multi-step wizard for source configuration (mapping -> de-id -> process)
- Data tables with preview capability
- Progress indicators for processing
- Confirmation dialogs for destructive actions

**Accessibility Requirements:**
- Target: WCAG 2.1 AA
- Specific needs: Keyboard-navigable file upload, screen reader support for progress

**Mobile/Responsive Requirements:**
- Desktop-first design
- Responsive down to tablet (1024px minimum)
- Mobile not required for MVP (power users on desktop)

### For Agent 6: Implementation Orchestrator

Per Constitution Section C/D: Global platform and API conventions apply.

**Security Middleware Required:**
- helmet (security headers)
- cors (cross-origin requests)
- express-rate-limit (rate limiting per Architecture)

**Critical Configuration:**
- Port 5000 (Replit)
- Trust proxy (for rate limiting)
- Vite watch ignored (Replit directories)

### Handoff Summary

| Metric | Value |
|--------|-------|
| Total user stories | 32 |
| MVP stories | 32 |
| Post-MVP stories | 0 |
| User personas | 3 |
| MVP features | 10 |
| Total pages | 24 |
| Estimated complexity | S: 5, M: 15, L: 4, XL: 2 |

**Recommended Human Review Points:**
- Teamwork Desk API authentication method and endpoints
- PII detection accuracy requirements
- MVP usage limits and billing model

---

## ASSUMPTION REGISTER

### AR-001: User Organization Membership Model
- **Type:** ASSUMPTION
- **Source Gap:** Executive brief states "multi-user organisations" but doesn't specify if users can belong to multiple organizations
- **Assumption Made:** Users belong to exactly one organization at a time (standard B2B SaaS pattern)
- **Impact if Wrong:** Need junction table (users_organizations), auth context must track "current organization", UI needs organization switcher, all API queries need org scoping changes
- **Proposed Resolution:** Confirm with stakeholder: "Can a single user account belong to multiple organizations?"
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22

### AR-002: Teamwork Desk Authentication Method
- **Type:** DEPENDENCY
- **Source Gap:** Executive brief mentions Teamwork Desk integration but doesn't specify API authentication method
- **Assumption Made:** API key authentication (simpler than OAuth for MVP)
- **Impact if Wrong:** Need OAuth flow implementation, token refresh handling, redirect URIs
- **Proposed Resolution:** Review Teamwork Desk API documentation to confirm authentication options
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22

### AR-003: File Storage Location
- **Type:** ASSUMPTION
- **Source Gap:** Executive brief doesn't specify where uploaded files are stored
- **Assumption Made:** Local filesystem storage within Replit container with 30-day retention
- **Impact if Wrong:** May need cloud storage (S3) integration for persistence across deploys
- **Proposed Resolution:** Verify Replit persistent storage capabilities and limitations
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22

### AR-004: Processing Execution Model
- **Type:** ASSUMPTION
- **Source Gap:** Executive brief mentions "manual batch processing" but doesn't specify sync vs async
- **Assumption Made:** Asynchronous processing with polling for status updates (to handle long-running jobs)
- **Impact if Wrong:** Synchronous processing may timeout; need different progress indication approach
- **Proposed Resolution:** Confirm expected processing duration for 100K records, determine if sync is viable
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22

### AR-005: Role-Based Access Scope
- **Type:** ASSUMPTION
- **Source Gap:** Executive brief mentions "role-based access" but only defines Admin and Member
- **Assumption Made:** Two roles sufficient: Admin (full access including team management) and Member (project access only)
- **Impact if Wrong:** Need additional roles (e.g., Project Admin, Viewer), more complex permission system
- **Proposed Resolution:** Confirm if additional roles are needed for MVP
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22

### AR-006: De-identification Scope
- **Type:** ASSUMPTION
- **Source Gap:** Executive brief mentions "PII detection and de-identification" but doesn't list specific PII types
- **Assumption Made:** Standard PII types: email, phone, name, address, SSN, credit card, date of birth
- **Impact if Wrong:** May need additional PII types (IP addresses, usernames, custom identifiers)
- **Proposed Resolution:** Review compliance requirements to confirm required PII detection scope
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22

### AR-007: Export Format Specifications
- **Type:** ASSUMPTION
- **Source Gap:** Executive brief lists "Conversational JSONL, Q&A pairs, Raw structured JSON" without detailed format specs
- **Assumption Made:** Standard formats: OpenAI-compatible JSONL for conversations, simple Q&A JSON pairs, raw JSON export of normalized data
- **Impact if Wrong:** Custom format requirements may need additional development
- **Proposed Resolution:** Confirm target AI platform format requirements
- **Status:** UNRESOLVED
- **Owner:** Human
- **Date:** 2026-01-22
